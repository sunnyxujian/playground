<!DOCTYPE html>
<!--
  é«˜çº§OCRè¯†åˆ«é¡µé¢ - æ”¯æŒå¤šç§OCRå¼•æ“
  æ¨èæ–¹æ¡ˆï¼š
  1. PaddleOCR.js - ä¸­æ–‡è¯†åˆ«ç‡æœ€é«˜ï¼ˆéœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼‰
  2. åœ¨çº¿API - ç™¾åº¦OCRã€è…¾è®¯OCRã€é˜¿é‡ŒOCRï¼ˆéœ€è¦APIå¯†é’¥ï¼‰
  3. Tesseract.js - å½“å‰ä½¿ç”¨çš„æ–¹æ¡ˆ
-->
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é«˜çº§OCRè¯†åˆ« - å¤šå¼•æ“æ”¯æŒ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Microsoft YaHei", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 28px;
      }

      .engine-selector {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
      }

      .engine-selector h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .engine-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .engine-option {
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        background: white;
      }

      .engine-option:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      }

      .engine-option.selected {
        border-color: #667eea;
        background: #f0f2ff;
      }

      .engine-option input[type="radio"] {
        margin-right: 10px;
      }

      .engine-option strong {
        display: block;
        color: #333;
        margin-bottom: 5px;
      }

      .engine-option .desc {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      .engine-option .rating {
        color: #ff9800;
        font-size: 12px;
        margin-top: 5px;
      }

      .api-config {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        border-left: 4px solid #ff9800;
        display: none;
      }

      .api-config.show {
        display: block;
      }

      .api-config input {
        width: 100%;
        padding: 8px;
        margin: 8px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .upload-area {
        border: 3px dashed #667eea;
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        background: #f8f9ff;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }

      .upload-area:hover {
        border-color: #764ba2;
        background: #f0f2ff;
      }

      .upload-area.dragover {
        border-color: #764ba2;
        background: #e8ebff;
        transform: scale(1.02);
      }

      #fileInput {
        display: none;
      }

      .preview-image {
        max-width: 100%;
        max-height: 400px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: block;
        margin: 20px auto;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 14px 32px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        flex: 1;
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }

      .button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .button-clear {
        background: #6c757d;
        flex: 0 0 auto;
        padding: 14px 24px;
      }

      .result-section {
        background: #f8f9ff;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .result-text {
        background: white;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #667eea;
        color: #333;
        line-height: 1.6;
        white-space: pre-wrap;
        word-break: break-all;
        min-height: 100px;
      }

      .info-box {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
        font-size: 14px;
        color: #1976d2;
      }

      .info-box strong {
        display: block;
        margin-bottom: 8px;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ” é«˜çº§OCRè¯†åˆ« - å¤šå¼•æ“æ”¯æŒ</h1>

      <div class="info-box">
        <strong>ğŸ’¡ æ¨èæ–¹æ¡ˆï¼ˆæŒ‰ä¸­æ–‡è¯†åˆ«ç‡æ’åºï¼‰ï¼š</strong>
        <ul style="margin: 8px 0 0 20px;">
          <li><strong>1. åœ¨çº¿APIï¼ˆæ¨èï¼‰</strong>ï¼šç™¾åº¦OCRã€è…¾è®¯OCRã€é˜¿é‡ŒOCR - è¯†åˆ«ç‡æœ€é«˜ï¼ˆ90%+ï¼‰ï¼Œéœ€è¦APIå¯†é’¥</li>
          <li><strong>2. PaddleOCR.js</strong>ï¼šä¸­æ–‡è¯†åˆ«ç‡å¾ˆé«˜ï¼ˆ85%+ï¼‰ï¼Œéœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼ˆçº¦50MBï¼‰</li>
          <li><strong>3. Tesseract.js</strong>ï¼šå½“å‰æ–¹æ¡ˆï¼Œè¯†åˆ«ç‡ä¸­ç­‰ï¼ˆ60-70%ï¼‰</li>
        </ul>
      </div>

      <div class="engine-selector">
        <h3>é€‰æ‹©OCRå¼•æ“</h3>
        <div class="engine-options">
          <label class="engine-option" id="option-api">
            <input type="radio" name="engine" value="api" />
            <strong>ğŸŒ åœ¨çº¿APIï¼ˆæ¨èï¼‰</strong>
            <div class="rating">â­â­â­â­â­ è¯†åˆ«ç‡æœ€é«˜</div>
            <div class="desc">ç™¾åº¦/è…¾è®¯/é˜¿é‡ŒOCR API</div>
          </label>
          <label class="engine-option" id="option-paddle">
            <input type="radio" name="engine" value="paddle" />
            <strong>ğŸš€ PaddleOCR.js</strong>
            <div class="rating">â­â­â­â­ è¯†åˆ«ç‡å¾ˆé«˜</div>
            <div class="desc">éœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶</div>
          </label>
          <label class="engine-option selected" id="option-tesseract">
            <input type="radio" name="engine" value="tesseract" checked />
            <strong>ğŸ“š Tesseract.js</strong>
            <div class="rating">â­â­â­ è¯†åˆ«ç‡ä¸­ç­‰</div>
            <div class="desc">å½“å‰ä½¿ç”¨çš„æ–¹æ¡ˆ</div>
          </label>
        </div>

        <div class="api-config" id="apiConfig">
          <strong>APIé…ç½®ï¼ˆé€‰æ‹©åœ¨çº¿APIæ—¶éœ€è¦ï¼‰ï¼š</strong>
          <select id="apiProvider" style="width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px;">
            <option value="baidu">ç™¾åº¦OCR</option>
            <option value="tencent">è…¾è®¯OCR</option>
            <option value="aliyun">é˜¿é‡Œäº‘OCR</option>
          </select>
          <input type="text" id="apiKey" placeholder="API Key / AppID" />
          <input type="text" id="apiSecret" placeholder="Secret Key / AppKey" />
          <div style="font-size: 12px; color: #666; margin-top: 8px;">
            ğŸ’¡ è·å–APIå¯†é’¥ï¼š
            <a href="https://cloud.baidu.com/product/ocr" target="_blank">ç™¾åº¦OCR</a> |
            <a href="https://cloud.tencent.com/product/ocr" target="_blank">è…¾è®¯OCR</a> |
            <a href="https://www.aliyun.com/product/ocr" target="_blank">é˜¿é‡ŒOCR</a>
          </div>
        </div>
      </div>

      <div class="upload-area" id="uploadArea">
        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
        <div style="color: #666; font-size: 16px; margin-bottom: 10px;">
          ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„
        </div>
        <div style="color: #999; font-size: 14px;">
          æ”¯æŒ JPGã€PNG ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼
        </div>
        <input type="file" id="fileInput" accept="image/*" />
      </div>

      <div class="hidden" id="previewSection">
        <img id="previewImage" class="preview-image" alt="é¢„è§ˆå›¾ç‰‡" />
      </div>

      <div class="button-group">
        <button class="button" id="recognizeBtn" disabled>å¼€å§‹è¯†åˆ«</button>
        <button class="button button-clear" id="clearBtn">æ¸…é™¤</button>
      </div>

      <div class="result-section hidden" id="resultSection">
        <div style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 15px;">
          è¯†åˆ«ç»“æœ
        </div>
        <div class="result-text" id="resultText"></div>
        <button
          class="button"
          id="copyBtn"
          style="margin-top: 15px; padding: 10px 20px; font-size: 14px;"
        >
          ğŸ“‹ å¤åˆ¶è¯†åˆ«ç»“æœ
        </button>
      </div>
    </div>

    <script>
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const previewSection = document.getElementById("previewSection");
      const previewImage = document.getElementById("previewImage");
      const recognizeBtn = document.getElementById("recognizeBtn");
      const resultSection = document.getElementById("resultSection");
      const resultText = document.getElementById("resultText");
      const clearBtn = document.getElementById("clearBtn");
      const copyBtn = document.getElementById("copyBtn");
      const apiConfig = document.getElementById("apiConfig");
      const apiProvider = document.getElementById("apiProvider");
      const apiKeyInput = document.getElementById("apiKey");
      const apiSecretInput = document.getElementById("apiSecret");

      let currentImage = null;
      let recognizedText = "";

      // å¼•æ“é€‰æ‹©
      const engineOptions = document.querySelectorAll('input[name="engine"]');
      engineOptions.forEach((option) => {
        option.addEventListener("change", (e) => {
          const value = e.target.value;
          document.querySelectorAll(".engine-option").forEach((el) => {
            el.classList.remove("selected");
          });
          document.getElementById(`option-${value}`).classList.add("selected");

          // æ˜¾ç¤º/éšè—APIé…ç½®
          if (value === "api") {
            apiConfig.classList.add("show");
          } else {
            apiConfig.classList.remove("show");
          }
        });
      });

      // æ–‡ä»¶ä¸Šä¼ 
      uploadArea.addEventListener("click", () => fileInput.click());
      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });
      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });
      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          handleFile(file);
        }
      });

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          handleFile(file);
        }
      });

      function handleFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          currentImage = e.target.result;
          previewImage.src = currentImage;
          previewSection.classList.remove("hidden");
          recognizeBtn.disabled = false;
          resultSection.classList.add("hidden");
        };
        reader.readAsDataURL(file);
      }

      // è¯†åˆ«åŠŸèƒ½
      recognizeBtn.addEventListener("click", async () => {
        if (!currentImage) return;

        const selectedEngine = document.querySelector('input[name="engine"]:checked').value;
        recognizeBtn.disabled = true;
        resultSection.classList.add("hidden");
        resultText.textContent = "è¯†åˆ«ä¸­...";

        try {
          let text = "";

          if (selectedEngine === "api") {
            text = await recognizeWithAPI(currentImage);
          } else if (selectedEngine === "paddle") {
            text = await recognizeWithPaddleOCR(currentImage);
          } else {
            text = await recognizeWithTesseract(currentImage);
          }

          recognizedText = text || "(æœªè¯†åˆ«åˆ°æ–‡å­—)";
          resultText.textContent = recognizedText;
          resultSection.classList.remove("hidden");
        } catch (error) {
          resultText.textContent = `è¯†åˆ«å¤±è´¥: ${error.message}\n\nå»ºè®®ï¼š\n1. æ£€æŸ¥å›¾ç‰‡æ˜¯å¦æ¸…æ™°\n2. å°è¯•åˆ‡æ¢OCRå¼•æ“\n3. å¦‚æœä½¿ç”¨APIï¼Œæ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®`;
          resultSection.classList.remove("hidden");
        } finally {
          recognizeBtn.disabled = false;
        }
      });

      // Tesseract.jsè¯†åˆ«
      async function recognizeWithTesseract(imageSrc) {
        // åŠ¨æ€åŠ è½½Tesseract
        if (typeof Tesseract === "undefined") {
          const script = document.createElement("script");
          script.src = "js/tesseract/tesseract.min.js";
          document.head.appendChild(script);
          await new Promise((resolve) => {
            script.onload = resolve;
          });
        }

        const worker = await Tesseract.createWorker("chi_sim", 1);
        const {
          data: { text },
        } = await worker.recognize(imageSrc);
        await worker.terminate();
        return text;
      }

      // PaddleOCR.jsè¯†åˆ«ï¼ˆéœ€è¦å…ˆä¸‹è½½æ¨¡å‹ï¼‰
      async function recognizeWithPaddleOCR(imageSrc) {
        throw new Error(
          "PaddleOCR.jséœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶ã€‚\n\nå®‰è£…æ­¥éª¤ï¼š\n1. è®¿é—® https://github.com/PaddlePaddle/PaddleOCR\n2. ä¸‹è½½PaddleOCR.jså’Œæ¨¡å‹æ–‡ä»¶\n3. å°†æ–‡ä»¶æ”¾å…¥é¡¹ç›®ç›®å½•\n\næˆ–è€…ä½¿ç”¨åœ¨çº¿APIè·å¾—æ›´å¥½çš„è¯†åˆ«æ•ˆæœã€‚"
        );
      }

      // åœ¨çº¿APIè¯†åˆ«
      async function recognizeWithAPI(imageSrc) {
        const provider = apiProvider.value;
        const key = apiKeyInput.value;
        const secret = apiSecretInput.value;

        if (!key || !secret) {
          throw new Error("è¯·å…ˆé…ç½®APIå¯†é’¥");
        }

        // å°†base64è½¬æ¢ä¸ºblob
        const base64Data = imageSrc.split(",")[1];
        const blob = await fetch(`data:image/png;base64,${base64Data}`).then((r) =>
          r.blob()
        );

        if (provider === "baidu") {
          return await recognizeWithBaiduOCR(blob, key, secret);
        } else if (provider === "tencent") {
          return await recognizeWithTencentOCR(blob, key, secret);
        } else {
          return await recognizeWithAliyunOCR(blob, key, secret);
        }
      }

      // ç™¾åº¦OCR API
      async function recognizeWithBaiduOCR(imageBlob, apiKey, secretKey) {
        // è·å–access_token
        const tokenResponse = await fetch(
          `https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${apiKey}&client_secret=${secretKey}`,
          { method: "POST" }
        );
        const tokenData = await tokenResponse.json();
        const accessToken = tokenData.access_token;

        if (!accessToken) {
          throw new Error("è·å–access_tokenå¤±è´¥ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥");
        }

        // è°ƒç”¨OCR API
        const formData = new FormData();
        formData.append("image", imageBlob);

        const ocrResponse = await fetch(
          `https://aip.baidubce.com/rest/2.0/ocr/v1/general_basic?access_token=${accessToken}`,
          {
            method: "POST",
            body: formData,
          }
        );

        const ocrData = await ocrResponse.json();
        if (ocrData.error_code) {
          throw new Error(`ç™¾åº¦OCRé”™è¯¯: ${ocrData.error_msg}`);
        }

        return ocrData.words_result
          .map((item) => item.words)
          .join("\n");
      }

      // è…¾è®¯OCR APIï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…éœ€è¦æ›´å¤šå‚æ•°ï¼‰
      async function recognizeWithTencentOCR(imageBlob, secretId, secretKey) {
        throw new Error(
          "è…¾è®¯OCRéœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒï¼ˆCORSé™åˆ¶ï¼‰ã€‚\n\nå»ºè®®ï¼š\n1. ä½¿ç”¨ç™¾åº¦OCRï¼ˆæ”¯æŒæµè§ˆå™¨ç›´æ¥è°ƒç”¨ï¼‰\n2. æˆ–æ­å»ºè‡ªå·±çš„APIä»£ç†æœåŠ¡å™¨"
        );
      }

      // é˜¿é‡Œäº‘OCR APIï¼ˆç®€åŒ–ç‰ˆï¼‰
      async function recognizeWithAliyunOCR(imageBlob, accessKeyId, accessKeySecret) {
        throw new Error(
          "é˜¿é‡Œäº‘OCRéœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒï¼ˆCORSé™åˆ¶ï¼‰ã€‚\n\nå»ºè®®ï¼š\n1. ä½¿ç”¨ç™¾åº¦OCRï¼ˆæ”¯æŒæµè§ˆå™¨ç›´æ¥è°ƒç”¨ï¼‰\n2. æˆ–æ­å»ºè‡ªå·±çš„APIä»£ç†æœåŠ¡å™¨"
        );
      }

      // æ¸…é™¤åŠŸèƒ½
      clearBtn.addEventListener("click", () => {
        currentImage = null;
        recognizedText = "";
        previewImage.src = "";
        previewSection.classList.add("hidden");
        resultSection.classList.add("hidden");
        recognizeBtn.disabled = true;
        fileInput.value = "";
      });

      // å¤åˆ¶åŠŸèƒ½
      copyBtn.addEventListener("click", async () => {
        if (!recognizedText) return;
        try {
          await navigator.clipboard.writeText(recognizedText);
          copyBtn.textContent = "âœ… å·²å¤åˆ¶ï¼";
          setTimeout(() => {
            copyBtn.textContent = "ğŸ“‹ å¤åˆ¶è¯†åˆ«ç»“æœ";
          }, 2000);
        } catch (err) {
          const textArea = document.createElement("textarea");
          textArea.value = recognizedText;
          textArea.style.position = "fixed";
          textArea.style.opacity = "0";
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand("copy");
          document.body.removeChild(textArea);
          copyBtn.textContent = "âœ… å·²å¤åˆ¶ï¼";
          setTimeout(() => {
            copyBtn.textContent = "ğŸ“‹ å¤åˆ¶è¯†åˆ«ç»“æœ";
          }, 2000);
        }
      });
    </script>
  </body>
</html>
